<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Products</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>

<body class="bg-light p-0 d-flex flex-column">
    <div class="p-0 pb-5">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center bg-white">
                <h2 class="mb-0">Products</h2>
              
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-light">
                            <tr>
                                <th class="py-0 px-1">Delete</th>
                                <th class="py-0 px-1">Name</th>
                                <th class="py-0 px-1">Description</th>
                                <th class="py-0 px-1">Price</th>
                                <th class="py-0 px-1">Quantity</th>
                                <th class="py-0 px-1">Category</th>
                                <th class="py-0 px-1">Status</th>
                                <th class="py-0 px-1">Edit</th>
                            </tr>
                        </thead>
                        <tbody id="productsTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
 
    <!-- Navigation Bar -->
    <nav class="sticky-bottom position-fixed bottom-0 w-100 navbar navbar-expand-lg bg-secondary d-flex justify-content-left gap-1 p-2">
             <div>
                <a href="index.html" class="btn btn-dark border-light">
                    <i class="bi bi-arrow-left"></i> Back
                </a>
                <a href="new.html" class="btn btn-primary ">
                    <i class="bi bi-plus-circle"></i> Add New Product
                </a>
               
            </div>
            <button class="btn btn-warning  ms-auto" onclick="loadData()">
                <i class="bi bi-arrow-clockwise"></i>
            </button>
        </nav>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // const API_URL = 'https://myshop-5hec.onrender.com';
        const API_URL = window.location.origin;

        async function fetchData(url, options = {}) {
            try {
                const response = await fetch(url, {
                    ...options,
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                return await response.json();
            } catch (error) {
                console.error('Error:', error);
                throw error;
            }
        }

        let products = [];

        async function loadData() {
            try {
                products = await fetchData(`${API_URL}/api/products`);
                console.log("got data");
                renderProducts();
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }

        function renderProducts() {
            const tbody = document.getElementById('productsTableBody');
            tbody.innerHTML = products.map(product => `
                <tr>
                    <td class="py-0 px-1">
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteProduct(${product.id})">
                            <i class="bi bi-trash"></i>
                        </button>
                    </td>
                    <td class="py-0 px-1">${product.name}</td>
                    <td class="py-0 px-1">${product.description || ''}</td>
                    <td class="py-0 px-1">$${Number(product.price).toFixed(2)}</td>
                    <td class="py-0 px-1">${product.quantity}</td>
                    <td class="py-0 px-1">${product.category || ''}</td>
                    <td class="py-0 px-1">
                        <span class="badge bg-${product.status === 'active' ? 'success' : 'secondary'}">${product.status}</span>
                    </td>
                    <td class="py-0 px-1">
                        <button class="btn btn-sm btn-outline-primary" onclick="editProduct(${product.id})">
                            <i class="bi bi-pencil"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }
 
        async function editProduct(id) {
            window.location.href = `edit.html?id=${id}`;
        }
 
        async function deleteProduct(id) {
            if (!confirm('Are you sure you want to delete this product?')) return;

            try {
                await fetchData(`${API_URL}/api/products/${id}`, {
                    method: 'DELETE'
                });

                products = products.filter(p => p.id !== id);
                renderProducts();
                
             } catch (error) {
                console.error('Error deleting product:', error);
             }
        }
 
        // Event Listeners
        // document.getElementById('saveProduct').addEventListener('click', saveProduct);
        // document.getElementById('updateProduct').addEventListener('click', updateProduct);

        // Initialize
        //loadData();
    </script>
 </body>
</html> 