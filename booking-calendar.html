<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booking Calendar</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>
<body style="overflow: hidden; height: 100vh; margin: 0; padding: 0;">
    <!-- Navigation Bar -->
    <nav class="fixed-bottom navbar navbar-expand-lg navbar-dark bg-primary">
            <div class="d-flex ms-auto">
                <a class="btn btn-outline-light mx-1 disabled" href="booking-calendar.html" title="Calendar"><i class="bi bi-calendar"></i></a>
                <a class="btn btn-outline-light mx-1" href="services.html" title="Services"><i class="bi bi-list-check"></i></a>
                <a class="btn btn-outline-light mx-1" href="products.html" title="Products"><i class="bi bi-box"></i></a>
                <a class="btn btn-outline-light mx-1" href="clients.html" title="Clients"><i class="bi bi-people"></i></a>
                <a class="btn btn-outline-light mx-1" href="admin.html" title="Admin"><i class="bi bi-shield-lock"></i></a>
                <a class="btn btn-outline-light mx-1" href="profile.html" title="Profile"><i class="bi bi-person"></i></a>
            </div>
     </nav>

    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <h1 class="text-center mb-4"></h1>
            </div>
        </div>
    </div>

    <div class="container-fluid p-0">
        <!-- Appointments Section -->
        <div style="height: calc(50vh - 56px); position: relative;">
            <div class="card h-100">
                <div class="card-header">
                    <h4 class="mb-0">Appointments</h4>
                </div>
                <div class="card-body p-0" style="overflow-y: auto; height: calc(100% - 120px);">
                    <div id="appointmentsList" class="list-group"></div>
                </div>
                <div class="card-footer">
                    <button class="btn btn-primary w-100" data-bs-toggle="modal" data-bs-target="#bookingDetailsModal">
                        <i class="bi bi-plus-circle"></i> New Appointment
                    </button>
                </div>
            </div>
        </div>

        <!-- Calendar Section -->
        <div style="height: 50vh; position: relative; background: var(--bs-light);">
            <div class="card h-100">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h4 class="mb-0">Calendar</h4>
                    <div class="d-flex align-items-center">
                        <h5 id="currentMonth" class="mb-0 me-2"></h5>
                        <button class="btn btn-outline-primary px-2 py-1 mx-1" id="prevMonth">
                            <i class="bi bi-chevron-left"></i>
                        </button>
                        <button class="btn btn-outline-primary px-2 py-1 mx-1" id="nextMonth">
                            <i class="bi bi-chevron-right"></i>
                        </button>
                    </div>
                </div>
                <div class="card-body p-0" style="overflow-y: auto;">
                    <div class="table-responsive">
                        <table class="table table-bordered mb-0">
                            <thead>
                                <tr>
                                    <th>Sun</th>
                                    <th>Mon</th>
                                    <th>Tue</th>
                                    <th>Wed</th>
                                    <th>Thu</th>
                                    <th>Fri</th>
                                    <th>Sat</th>
                                </tr>
                            </thead>
                            <tbody id="calendarBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Booking Details Modal -->
    <div class="modal fade" id="bookingDetailsModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">New Appointment</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="bookingForm">
                        <div class="mb-3">
                            <label for="serviceSelect" class="form-label">Service</label>
                            <select class="form-select" id="serviceSelect" required>
                                <option value="">Select a service</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="clientSearch" class="form-label">Client</label>
                            <select class="form-select" id="clientSearch" required>
                                <option value="">Select a client</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="employeeSelect" class="form-label">Employee</label>
                            <select class="form-select" id="employeeSelect" required>
                                <option value="">Select an employee</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="dateInput" class="form-label">Date</label>
                            <input type="date" class="form-control" id="dateInput" required>
                        </div>
                        <div class="mb-3">
                            <label for="timeSlots" class="form-label">Time</label>
                            <select class="form-select" id="timeSlots" required>
                                <option value="">Select a time</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="confirmBooking">Confirm Booking</button>
                </div>
            </div>
        </div>
    </div>

    <!-- New Client Modal -->
    <div class="modal fade" id="newClientModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">New Client</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="newClientForm">
                        <div class="mb-3">
                            <label for="newClientName" class="form-label">Name</label>
                            <input type="text" class="form-control" id="newClientName" required>
                        </div>
                        <div class="mb-3">
                            <label for="newClientEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="newClientEmail" required>
                        </div>
                        <div class="mb-3">
                            <label for="newClientPhone" class="form-label">Phone</label>
                            <input type="tel" class="form-control" id="newClientPhone" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveNewClient">Save Client</button>
                </div>
            </div>
        </div>
    </div>

    <div class="position-fixed top-0 start-50 " style="z-index: 11">
        <div id="toastContainer"></div>
    </div>

    <div class="position-fixed top-50 start-50 translate-middle" id="loadingSpinner" style="display:none;">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <div class="modal fade" id="summaryModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Booking Summary</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="card">
                        <div class="card-body">
                            <h6 class="card-subtitle mb-2 text-muted">Appointment Details</h6>
                            <p><strong>Date:</strong> <span id="summaryDate"></span></p>
                            <p><strong>Time:</strong> <span id="summaryTime"></span></p>
                            <p><strong>Service:</strong> <span id="summaryService"></span></p>
                            <p><strong>Duration:</strong> <span id="summaryDuration"></span></p>
                            <p><strong>Price:</strong> <span id="summaryPrice"></span></p>
                            <p><strong>Client:</strong> <span id="summaryClient"></span></p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Edit</button>
                    <button type="button" class="btn btn-primary" id="finalConfirm">Confirm Booking</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Appointment Modal -->
    <div class="modal fade" id="editAppointmentModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Appointment</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editAppointmentForm">
                        <input type="hidden" id="editAppointmentId">
                        <div class="mb-3">
                            <label for="editServiceSelect" class="form-label">Service</label>
                            <select class="form-select" id="editServiceSelect" required>
                                <option value="">Select a service</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="editClientSelect" class="form-label">Client</label>
                            <select class="form-select" id="editClientSelect" required>
                                <option value="">Select a client</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="editDateInput" class="form-label">Date</label>
                            <input type="date" class="form-control" id="editDateInput" required>
                        </div>
                        <div class="mb-3">
                            <label for="editTimeSlots" class="form-label">Time</label>
                            <select class="form-select" id="editTimeSlots" required>
                                <option value="">Select a time</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="editStatus" class="form-label">Status</label>
                            <select class="form-select" id="editStatus" required>
                                <option value="scheduled">Scheduled</option>
                                <option value="in-progress">In Progress</option>
                                <option value="completed">Completed</option>
                                <option value="cancelled">Cancelled</option>
                                <option value="running-late">Running Late</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveAppointmentChanges">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const config = {
            local: 'http://localhost:3000',
            production: 'https://myshop-5hec.onrender.com'
        };
        
        const isLocalhost = window.location.hostname === 'localhost' || 
                          window.location.hostname === '127.0.0.1';
        const API_URL = isLocalhost ? config.local : config.production;

        async function fetchData(url, options = {}) {
            try {
                const response = await fetch(url, {
                    ...options,
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                return response.json();
            } catch (error) {
                console.error('Fetch error:', error);
                throw error;
            }
        }

        let currentDate = new Date();
        let appointments = [];
        let services = [];
        let clients = [];
        let employees = [];

        async function loadData() {
            try {
                const [servicesData, clientsData, appointmentsData] = await Promise.all([
                    fetchData(`${API_URL}/api/services`),
                    fetchData(`${API_URL}/api/clients`),
                    fetchData(`${API_URL}/api/appointments`)
                ]);

                services = servicesData;
                clients = clientsData;
                appointments = appointmentsData;

                renderCalendar();
                renderAppointments();
                populateFormSelects();
            } catch (error) {
                console.error('Error loading data:', error);
                showToast('Failed to load data', 'danger');
            }
        }

        function populateFormSelects() {
            // Populate service select
            const serviceSelect = document.getElementById('serviceSelect');
            serviceSelect.innerHTML = '<option value="">Select a service</option>' +
                services.map(service => `<option value="${service.id}">${service.name} - $${service.price}</option>`).join('');

            // Populate client select
            const clientSelect = document.getElementById('clientSearch');
            clientSelect.innerHTML = '<option value="">Select a client</option>' +
                clients.map(client => `<option value="${client.id}">${client.name}</option>`).join('');
        }

        function renderAppointments() {
            const appointmentsList = document.getElementById('appointmentsList');
            appointmentsList.innerHTML = appointments.map(appointment => {
                const service = services.find(s => s.id === appointment.service_id);
                const client = clients.find(c => c.id === appointment.client_id);
                const employee = employees.find(e => e.id === appointment.employee_id);
                
                const appointmentDate = new Date(appointment.date);
                const formattedDate = appointmentDate.toLocaleDateString('en-US', { 
                    weekday: 'short', 
                    month: 'short', 
                    day: 'numeric' 
                });
                
                return `
                    <div class="list-group-item">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1">${client?.name || 'Unknown Client'}</h6>
                                <small class="text-muted">
                                    <div>${service?.name || 'Unknown Service'}</div>
                                    <div>${formattedDate} at ${appointment.time}</div>
                                    <div>Duration: ${appointment.duration} min</div>
                                    <div>Price: $${Number(appointment.price).toFixed(2)}</div>
                                    <div>Employee: ${employee?.username || 'Unassigned'}</div>
                                    <div>Status: ${appointment.status}</div>
                                </small>
                            </div>
                            <div class="d-flex flex-column align-items-end">
                                <span class="badge bg-${getStatusColor(appointment.status)} mb-1">${appointment.status}</span>
                                <small class="text-muted">
                                    Created: ${new Date(appointment.created_at).toLocaleDateString()}
                                </small>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startingDay = firstDay.getDay();
            const totalDays = lastDay.getDate();

            document.getElementById('currentMonth').textContent = 
                `${currentDate.toLocaleString('default', { month: 'long' })} ${year}`;

            let calendarHTML = '';
            let day = 1;

            for (let i = 0; i < 6; i++) {
                calendarHTML += '<tr>';
                for (let j = 0; j < 7; j++) {
                    if (i === 0 && j < startingDay) {
                        calendarHTML += '<td></td>';
                    } else if (day > totalDays) {
                        calendarHTML += '<td></td>';
                    } else {
                        const date = new Date(year, month, day);
                        const dayAppointments = appointments.filter(a => {
                            const appointmentDate = new Date(a.date);
                            return appointmentDate.getDate() === day && 
                                   appointmentDate.getMonth() === month && 
                                   appointmentDate.getFullYear() === year;
                        });

                        const dateString = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                        calendarHTML += `
                            <td class="calendar-day ${dayAppointments.length ? 'has-appointments' : ''}" 
                                data-date="${dateString}">
                                ${day}
                                ${dayAppointments.length ? 
                                    `<span class="badge bg-primary">${dayAppointments.length}</span>` : 
                                    ''}
                            </td>
                        `;
                        day++;
                    }
                }
                calendarHTML += '</tr>';
            }

            document.getElementById('calendarBody').innerHTML = calendarHTML;
            addCalendarDayListeners();
        }

        function addCalendarDayListeners() {
            document.querySelectorAll('.calendar-day').forEach(day => {
                day.addEventListener('click', () => {
                    const date = day.dataset.date;
                    const [year, month, dayNum] = date.split('-').map(Number);
                    const selectedDate = new Date(year, month - 1, dayNum);
                    
                    const dayAppointments = appointments.filter(a => {
                        const appointmentDate = new Date(a.date);
                        return appointmentDate.getDate() === dayNum && 
                               appointmentDate.getMonth() === month - 1 && 
                               appointmentDate.getFullYear() === year;
                    });
                    
                    const appointmentsList = document.getElementById('appointmentsList');
                    appointmentsList.innerHTML = dayAppointments.map(appointment => {
                        const service = services.find(s => s.id === appointment.service_id);
                        const client = clients.find(c => c.id === appointment.client_id);
                        return `
                            <div class="list-group-item appointment-item" data-appointment-id="${appointment.id}">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="mb-1">${client?.name || 'Unknown Client'}</h6>
                                        <small class="text-muted">${service?.name || 'Unknown Service'} - ${appointment.time}</small>
                                    </div>
                                    <span class="badge bg-${getStatusColor(appointment.status)}">${appointment.status}</span>
                                </div>
                            </div>
                        `;
                    }).join('');

                    // Add click listeners to appointment items
                    document.querySelectorAll('.appointment-item').forEach(item => {
                        item.addEventListener('click', () => {
                            const appointmentId = parseInt(item.dataset.appointmentId);
                            const appointment = appointments.find(a => a.id === appointmentId);
                            if (appointment) {
                                openEditAppointmentModal(appointment);
                            }
                        });
                    });
                });
            });
        }

        function openEditAppointmentModal(appointment) {
            const modal = new bootstrap.Modal(document.getElementById('editAppointmentModal'));
            
            // Set the appointment ID
            document.getElementById('editAppointmentId').value = appointment.id;
            
            // Populate service options
            const editServiceSelect = document.getElementById('editServiceSelect');
            editServiceSelect.innerHTML = `
                <option value="">Select a service</option>
                ${services.map(s => `
                    <option value="${s.id}" ${s.id === appointment.service_id ? 'selected' : ''}>
                        ${s.name} (${s.duration} min) - $${s.price}
                    </option>
                `).join('')}
            `;

            // Populate client options
            const editClientSelect = document.getElementById('editClientSelect');
            editClientSelect.innerHTML = `
                <option value="">Select a client</option>
                ${clients.map(c => `
                    <option value="${c.id}" ${c.id === appointment.client_id ? 'selected' : ''}>
                        ${c.name}
                    </option>
                `).join('')}
            `;

            // Set date and time
            document.getElementById('editDateInput').value = appointment.date;
            document.getElementById('editTimeSlots').value = appointment.time;
            
            // Set status
            document.getElementById('editStatus').value = appointment.status;

            // Generate time slots based on selected service
            generateEditTimeSlots();

            modal.show();
        }

        function generateEditTimeSlots() {
            const timeSlots = document.getElementById('editTimeSlots');
            const serviceSelect = document.getElementById('editServiceSelect');
            const selectedService = services.find(s => s.id === parseInt(serviceSelect.value));
            const currentTime = document.getElementById('editTimeSlots').value;
            
            if (!selectedService) {
                timeSlots.innerHTML = '<option value="">Select a service first</option>';
                return;
            }

            const slots = [];
            const startTime = 9; // 9 AM
            const endTime = 17; // 5 PM
            const interval = 15; // 15 minutes

            for (let hour = startTime; hour < endTime; hour++) {
                for (let minute = 0; minute < 60; minute += interval) {
                    const time = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                    slots.push(`<option value="${time}" ${time === currentTime ? 'selected' : ''}>${time}</option>`);
                }
            }

            timeSlots.innerHTML = `
                <option value="">Select a time</option>
                ${slots.join('')}
            `;
        }

        function getStatusColor(status) {
            switch (status) {
                case 'scheduled': return 'primary';
                case 'in-progress': return 'warning';
                case 'completed': return 'success';
                case 'cancelled': return 'danger';
                case 'running-late': return 'info';
                default: return 'secondary';
            }
        }

        function showToast(message, type = 'success') {
            const toastContainer = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast align-items-center text-white bg-${type} border-0`;
            toast.setAttribute('role', 'alert');
            toast.setAttribute('aria-live', 'assertive');
            toast.setAttribute('aria-atomic', 'true');
            
            toast.innerHTML = `
                <div class="d-flex justify-content-start">
                    <div class="toast-body">
                        ${message}
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
            `;
            
            toastContainer.appendChild(toast);
            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();
            
            toast.addEventListener('hidden.bs.toast', () => {
                toast.remove();
            });
        }

        document.getElementById('serviceSelect').addEventListener('change', generateTimeSlots);

        document.getElementById('prevMonth').addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        });

        document.getElementById('nextMonth').addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        });

        document.getElementById('confirmBooking').addEventListener('click', async () => {
            const serviceId = document.getElementById('serviceSelect').value;
            const clientId = document.getElementById('clientSearch').value;
            const employeeId = document.getElementById('employeeSelect').value;
            const date = document.getElementById('dateInput').value;
            const time = document.getElementById('timeSlots').value;

            if (!serviceId || !clientId || !employeeId || !date || !time) {
                showToast('Please fill in all fields', 'danger');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/api/appointments`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        service_id: serviceId,
                        client_id: clientId,
                        employee_id: employeeId,
                        date: date,
                        time: time
                    })
                });

                if (response.ok) {
                    const newAppointment = await response.json();
                    appointments.push(newAppointment);
                    renderAppointments();
                    renderCalendar();
                    bootstrap.Modal.getInstance(document.getElementById('bookingDetailsModal')).hide();
                    document.getElementById('bookingForm').reset();
                    showToast('Appointment booked successfully', 'success');
                } else {
                    throw new Error('Failed to book appointment');
                }
            } catch (error) {
                console.error('Error booking appointment:', error);
                showToast('Failed to book appointment', 'danger');
            }
        });

        document.getElementById('saveNewClient').addEventListener('click', async () => {
            const name = document.getElementById('newClientName').value;
            const email = document.getElementById('newClientEmail').value;
            const phone = document.getElementById('newClientPhone').value;

            if (!name || !email || !phone) {
                // showToast('Please fill in all fields', 'danger');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/api/clients`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ name, email, phone })
                });

                if (response.ok) {
                    const newClient = await response.json();
                    clients.push(newClient);
                    renderClientOptions();
                    bootstrap.Modal.getInstance(document.getElementById('newClientModal')).hide();
                    document.getElementById('newClientForm').reset();
                    // showToast('Client added successfully', 'success');
                } else {
                    throw new Error('Failed to add client');
                }
            } catch (error) {
                console.error('Error adding client:', error);
                // showToast('Failed to add client', 'danger');
            }
        });

        document.getElementById('editServiceSelect').addEventListener('change', generateEditTimeSlots);

        document.getElementById('saveAppointmentChanges').addEventListener('click', async () => {
            const appointmentId = document.getElementById('editAppointmentId').value;
            const serviceId = document.getElementById('editServiceSelect').value;
            const clientId = document.getElementById('editClientSelect').value;
            const date = document.getElementById('editDateInput').value;
            const time = document.getElementById('editTimeSlots').value;
            const status = document.getElementById('editStatus').value;

            if (!serviceId || !clientId || !date || !time || !status) {
                return;
            }

            try {
                const response = await fetch(`${API_URL}/api/appointments/${appointmentId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        service_id: serviceId,
                        client_id: clientId,
                        date: date,
                        time: time,
                        status: status
                    })
                });

                if (response.ok) {
                    const updatedAppointment = await response.json();
                    const index = appointments.findIndex(a => a.id === appointmentId);
                    if (index !== -1) {
                        appointments[index] = updatedAppointment;
                    }
                    renderAppointments();
                    renderCalendar();
                    bootstrap.Modal.getInstance(document.getElementById('editAppointmentModal')).hide();
                } else {
                    throw new Error('Failed to update appointment');
                }
            } catch (error) {
                console.error('Error updating appointment:', error);
            }
        });

        async function logout() {
            try {
                await fetchData(`${API_URL}/api/logout`, {
                    method: 'POST'
                });
                sessionStorage.removeItem('user');
            } catch (error) {
                console.error('Logout error:', error);
                showToast('Failed to logout', 'danger');
            }
        }
 
        // Initialize dark mode
        async function initializeDarkMode() {
            try {
                const user = JSON.parse(sessionStorage.getItem('user'));
                if (!user) return;
                
                const response = await fetchData(`${API_URL}/api/users/${user.id}`);
                const userData = response;
                
                if (userData.dark_mode) {
                    document.body.classList.add('dark-mode');
                    const icon = document.getElementById('darkModeToggle').querySelector('i');
                    icon.className = 'bi bi-sun-fill';
                }
            } catch (error) {
                console.error('Error initializing dark mode:', error);
            }
        }

        // Initialize
        loadData();
    </script>


</body>
</html> 